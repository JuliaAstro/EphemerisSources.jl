<!DOCTYPE html><HTML lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><head><script charset="utf-8" src="../assets/default/multidoc_injector.js" type="text/javascript"></script><script charset="utf-8" type="text/javascript">window.MULTIDOCUMENTER_ROOT_PATH = '/'</script><script charset="utf-8" src="../assets/default/flexsearch.bundle.js" type="text/javascript"></script><script charset="utf-8" src="../assets/default/flexsearch_integration.js" type="text/javascript"></script><meta charset="utf-8"/><meta content="quarto-1.5.55" name="generator"/><meta content="width=device-width, initial-scale=1.0, user-scalable=yes" name="viewport"/><meta content="2024-06-09" name="dcterms.date"/><title>EphemerisSources.jl: Idiomatic Ephemeris Sourcing and Parsing in Julia</title><style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style><script src="site_libs/clipboard/clipboard.min.js"></script><script src="site_libs/quarto-html/quarto.js"></script><script src="site_libs/quarto-html/popper.min.js"></script><script src="site_libs/quarto-html/tippy.umd.min.js"></script><script src="site_libs/quarto-html/anchor.min.js"></script><link href="site_libs/quarto-html/tippy.css" rel="stylesheet"/><link href="site_libs/quarto-html/quarto-syntax-highlighting.css" id="quarto-text-highlighting-styles" rel="stylesheet"/><script src="site_libs/bootstrap/bootstrap.min.js"></script><link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet"/><link data-mode="light" href="site_libs/bootstrap/bootstrap.min.css" id="quarto-bootstrap" rel="stylesheet"/><link href="https://cdn.jsdelivr.net/gh/dreampulse/computer-modern-web-font@master/fonts.css" rel="stylesheet" type="text/css"/><link href="static.css" rel="stylesheet"/><meta content="EphemerisSources.jl: Idiomatic Ephemeris Sourcing and Parsing in Julia" name="citation_title"/><meta content="Joseph D. Carpinelli" name="citation_author"/><meta content="2024-06-09" name="citation_publication_date"/><meta content="2024-06-09" name="citation_cover_date"/><meta content="2024" name="citation_year"/><meta content="2024-06-09" name="citation_online_date"/><meta content="en" name="citation_language"/><meta content="citation_title=Ancillary Data Services of NASA’s Navigation and Ancillary Information Facility;,citation_author=C. H. Acton;,citation_publication_date=1996;,citation_cover_date=1996;,citation_year=1996;,citation_issue=1;,citation_doi=10.1016/0032-0633(95)00107-7;,citation_volume=44;,citation_journal_title=Planetary and Space Science;" name="citation_reference"/><meta content="citation_title=Status of the JPL horizons ephemeris system;,citation_author=Jon D Giorgini;,citation_publication_date=2015;,citation_cover_date=2015;,citation_year=2015;,citation_volume=29;,citation_journal_title=IAU General Assembly;" name="citation_reference"/><link href="../assets/default/multidoc.css" rel="stylesheet" type="text/css"/><link href="../assets/default/flexsearch.css" rel="stylesheet" type="text/css"/></head><body><nav id="multi-page-nav"><a class="brand" href="https://juliaastro.org"><img alt="home" src="http://juliaastro.org/dev/assets/logo.svg"/></a><div class="hidden-on-mobile" id="nav-items"><a class="nav-link nav-item" href="../docs/">EphemerisSources.jl</a><a class="nav-link nav-item" href="./">Paper</a><div class="nav-dropdown"><button class="nav-item dropdown-label">Interfaces</button><ul class="nav-dropdown-container"><a class="nav-link nav-item" href="../docs/EphemerisSourcesBase/">EphemerisSourcesBase</a></ul></div><div class="nav-dropdown"><button class="nav-item dropdown-label">SPICE</button><ul class="nav-dropdown-container"><a class="nav-link nav-item" href="../docs/SPICEKernels/">SPICEKernels</a><a class="nav-link nav-item" href="../docs/SPICEBodies/">SPICEBodies</a></ul></div><div class="nav-dropdown"><button class="nav-item dropdown-label">Horizons</button><ul class="nav-dropdown-container"><a class="nav-link nav-item" href="../docs/HorizonsAPI/">HorizonsAPI</a><a class="nav-link nav-item" href="../docs/HorizonsEphemeris/">HorizonsEphemeris</a></ul></div><div class="search nav-item"><input id="search-input" placeholder="Search..."/><ul class="suggestions hidden" id="search-result-container"></ul><div class="search-keybinding">/</div></div></div><button id="multidoc-toggler"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg></button></nav><header class="quarto-title-block default toc-left page-columns page-full" id="title-block-header"><div class="quarto-title-banner page-columns page-full"><div class="quarto-title column-body"><h1 class="title">EphemerisSources.jl: Idiomatic Ephemeris Sourcing and Parsing in Julia</h1></div><div class="quarto-title-meta-container"><div class="quarto-title-meta-column-start"><div class="quarto-title-meta-author"><div class="quarto-title-meta-heading">Author</div><div class="quarto-title-meta-heading">Affiliation</div><div class="quarto-title-meta-contents"><p class="author">Joseph D. Carpinelli <a class="quarto-title-author-email" href="mailto:joseph.d.carpinelli@loopy.codes"><i class="bi bi-envelope"></i></a><a class="quarto-title-author-orcid" href="https://orcid.org/0000-0001-8655-8125"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="/></a></p></div><div class="quarto-title-meta-contents"><p class="affiliation">
                        Independent Researcher, USA
                      </p></div></div><div class="quarto-title-meta"><div><div class="quarto-title-meta-heading">Published</div><div class="quarto-title-meta-contents"><p class="date">June 9, 2024</p></div></div></div></div><div class="quarto-title-meta-column-end quarto-other-formats-target"></div></div><div class="quarto-other-links-text-target"></div></div></header><div class="page-columns page-rows-contents page-layout-article toc-left" id="quarto-content"><div class="sidebar toc-left" id="quarto-sidebar-toc-left"><nav class="toc-active" id="TOC" role="doc-toc"><h2 id="toc-title">Table of contents</h2><ul><li><a class="nav-link active" data-scroll-target="#summary" href="#summary" id="toc-summary">Summary</a></li><li><a class="nav-link" data-scroll-target="#statement-of-need" href="#statement-of-need" id="toc-statement-of-need">Statement of Need</a><ul class="collapse"><li><a class="nav-link" data-scroll-target="#jpl-horizons" href="#jpl-horizons" id="toc-jpl-horizons">JPL Horizons</a></li><li><a class="nav-link" data-scroll-target="#jpl-spice" href="#jpl-spice" id="toc-jpl-spice">JPL SPICE</a></li></ul></li><li><a class="nav-link" data-scroll-target="#usage" href="#usage" id="toc-usage">Usage</a></li><li><a class="nav-link" data-scroll-target="#external-packages" href="#external-packages" id="toc-external-packages">External Packages</a></li><li><a class="nav-link" data-scroll-target="#sec-acknowledgements" href="#sec-acknowledgements" id="toc-sec-acknowledgements">Acknowledgements</a></li><li><a class="nav-link" data-scroll-target="#disclaimers" href="#disclaimers" id="toc-disclaimers">Disclaimers</a></li><li><a class="nav-link" data-scroll-target="#references" href="#references" id="toc-references">References</a></li></ul><div class="quarto-alternate-notebooks"><h2>Notebooks</h2><ul><li><a href="notebooks/closest-approach-preview.html"><i class="bi bi-journal-code"></i>Case Study: JWST &amp; GAIA</a></li><li><a href="notebooks/circular-velocity-preview.html"><i class="bi bi-journal-code"></i>Case Study: Orbital Velocities</a></li></ul></div></nav></div><div class="sidebar margin-sidebar zindex-bottom" id="quarto-margin-sidebar"></div><main class="content quarto-banner-title-block" id="quarto-document-content"><div class="callout-note callout callout-style-simple"><div class="callout-body d-flex"><div class="callout-icon-container"><i class="callout-icon"></i></div><div class="callout-body-container"><p><i>
              This page is a <b>pre-print</b>! The published paper is available at 
              the <a href="https://joss.theoj.org/papers/10.21105/joss.06914">Journal of Open Source Software</a>.
            </i></p></div></div></div><section class="level1" id="summary"><h1>Summary</h1><p>Students and professionals in astronomy, astrodynamics, astrophysics, and other related fields often download and parse data about objects in our solar system — ephemeris data — from two major providers: JPL’s publicly-available <a href="https://naif.jpl.nasa.gov/pub/naif/generic_kernels/">Generic SPICE Kernels</a> and JPL’s <a href="https://ssd.jpl.nasa.gov/horizons/">Horizons platform</a>. SPICE kernels are typically read through the SPICE Toolkit, which is available in a variety of programming languages, including the C Programming Language with <code>CSPICE</code><span class="citation" data-cites="cspice">(<a href="#ref-cspice" role="doc-biblioref">Acton 1996</a>)</span>. The Julia packages <a href="https://github.com/JuliaBinaryWrappers/CSPICE_jll.jl"><code>CSPICE_jll.jl</code></a> and <a href="https://github.com/JuliaAstro/SPICE.jl"><code>SPICE.jl</code></a> expose many <code>CSPICE</code> functions through Julia functions. Julia users can load and interact with SPICE kernels through methods such as <code>SPICE.furnsh</code> and <code>SPICE.spkez</code>. Horizons provides data through a variety of methods, including email, command-line, graphical web interfaces, and a <a href="https://ssd-api.jpl.nasa.gov/doc/horizons.html">REST API</a><span class="citation" data-cites="horizons">(<a href="#ref-horizons" role="doc-biblioref">Giorgini 2015</a>)</span>.</p><p>This paper introduces several packages — <code>SPICEKernels.jl</code>, <code>SPICEBodies.jl</code>, <code>HorizonsAPI.jl</code> and <code>HorizonsEphemeris.jl</code> — which allow users to download and process Cartesian state vector data idiomatically, all from within Julia. While ephemeris data comes in many forms, including observer tables, osculating orbital elements, and binary formats, these packages currently target Cartesian state vector (position and velocity) ephemeris data. Through the use of these packages, users can share replicable code which automatically fetches data from publicly-available ephemeris sources, as opposed to manually including ephemeris data files with their source code distribution.</p></section><section class="level1" id="statement-of-need"><h1>Statement of Need</h1><p>While astronomers, astrodynamicists, and other ephemeris users have the tools they need to fetch and parse position and velocity data from multiple sources within Julia, they do not have the tools to do so <em>simply</em> or <em>idiomatically</em>. Horizons’ ephemeris data is distributed in plain text with surrounding metadata, and manual parsing is required for users to programmatically use the fetched ephemeris data. Generic SPICE kernels are freely available and can be used with <code>CSPICE</code> (and wrapper libraries) for kernel inspection and data retrieval, but new users and students may find the required workflows unfamiliar. The packages presented in this paper may be used by students and professionals to idiomatically inspect and use Cartesian state vector ephemeris data, without prior knowledge of SPICE Toolkit utilities or REST APIs.</p><section class="level2" id="jpl-horizons"><h2 class="anchored" data-anchor-id="jpl-horizons">JPL Horizons</h2><p>The two Horizons-related packages presented in this paper — <a href="https://github.com/JuliaAstro/EphemerisSources.jl/tree/main/lib/HorizonsAPI"><code>HorizonsAPI.jl</code></a> and <a href="https://github.com/JuliaAstro/EphemerisSources.jl/tree/main/lib/HorizonsEphemeris"><code>HorizonsEphemeris.jl</code></a> — are respectively the first Julia packages to precisely match the REST API with tab-completion through <em>static keyword arguments</em><a class="footnote-ref" href="#fn1" id="fnref1" role="doc-noteref"><sup>1</sup></a>, and the first to offer automatic response parsing into <code>NamedTuple</code> types. The <code>NamedTuple</code> output of <code>HorizonsEphemeris.ephemeris</code>, the top-level method for fetching Cartesian state vectors from the Horizons platform, allows for easy plotting, CSV file-saving, and <code>DataFrame</code> construction. Both <code>HorizonsAPI.jl</code> and <code>HorizonsEphemeris.jl</code> offer users a simple, repeatable way to query and parse Horizons state vector data. Parsing for other ephemeris types, including observer tables and osculating orbital element tables, are desired features but are not yet implemented. For sending Horizons requests for these other ephemeris types, use <code>HorizonsAPI</code> methods to manually construct each request, or see <a href="https://github.com/PerezHz/Horizons.jl"><code>Horizons.jl</code></a>.</p></section><section class="level2" id="jpl-spice"><h2 class="anchored" data-anchor-id="jpl-spice">JPL SPICE</h2><p>The two SPICE-related packages presented in this paper — <a href="https://github.com/JuliaAstro/EphemerisSources.jl/tree/main/lib/SPICEKernels"><code>SPICEKernels.jl</code></a>, and <a href="https://github.com/JuliaAstro/EphemerisSources.jl/tree/main/lib/SPICEBodies"><code>SPICEBodies.jl</code></a> — provide idiomatic kernel fetching, inspection, and caching from within Julia. Previously, Julia users interacted with SPICE kernels by manually downloading publicly-available <a href="https://naif.jpl.nasa.gov/pub/naif/generic_kernels/">generic kernels</a> and parsing the data using <code>SPICE.jl</code>, or another ephemeris parsing source. This workflow requires that users know how to find the appropriate generic kernels for their chosen application, and that they know how to use CSPICE functions to retrieve their desired data. <code>SPICEKernels.jl</code> and <code>SPICEBodies.jl</code> offer idiomatic interfaces to ephemeris fetching and parsing respectively. The <code>SPICEKernels.jl</code> project uses continuous integration to fetch and parse publicly-available <a href="https://naif.jpl.nasa.gov/pub/naif/generic_kernels">kernels</a> and expose each kernel as a variable in a new package release. SPICE Toolkit executables, provided by <a href="https://github.com/JuliaAstro/SPICE.jl/tree/main/lib/SPICEApplications"><code>SPICEApplications.jl</code></a>, are used to fill each corresponding kernel variable’s docstring with a description of the kernel’s contents. <code>SPICEKernels.jl</code> users can utilize tab-completion and Julia’s built-in documentation tools to help select the most appropriate generic kernel for their application. Once each kernel is loaded into the SPICE kernel pool with <code>SPICE.jl</code>, users can use <code>SPICEBodies.jl</code> to idiomatically fetch state vector data at provided epochs.</p></section></section><section class="level1" id="usage"><h1>Usage</h1><p>For detailed usage examples, consult the common <a href="https://juliaastro.org/EphemerisSources.jl">documentation site</a>.</p></section><section class="level1" id="external-packages"><h1>External Packages</h1><p>The packages presented in this paper which interact with the SPICE Toolkit require users to use <a href="https://github.com/JuliaAstro/SPICE.jl"><code>SPICE.jl</code></a>, or another SPICE-compatible kernel loading tool. <code>SPICEBodies.jl</code> uses the kernel cache that is created with <code>SPICE.furnsh</code>. Support for other SPICE kernel management packages, such as <a href="https://github.com/JuliaSpaceMissionDesign/Ephemerides.jl"><code>Ephemerides.jl</code></a>, may be added in the future. Support for <code>Ephemerides.jl</code> is particularly desirable, as it enables fetching kernel data in multi-threaded contexts. In addition to the packages in this paper which interface with the JPL Horizons ephemeris platform, the <a href="https://github.com/PerezHz/Horizons.jl"><code>Horizons.jl</code></a> package offers simplified interfaces for constructing and sending queries to the JPL Horizons REST API. The <code>Horizons.jl</code> package provides support for all Horizons query types, as does <code>HorizonsAPI.jl</code>. As stated previously, <code>HorizonsEphemeris.jl</code> currently only supports parsing for Cartesian state vector data.</p></section><section class="level1" id="sec-acknowledgements"><h1>Acknowledgements</h1><p>Joseph Wilson (user <code>@jollywatt</code> on Julia’s <a href="https://discourse.julialang.org/u/Jollywatt/summary">Discourse</a>) provided incredibly helpful <a href="https://discourse.julialang.org/t/unpack-namedtuple-into-a-function-definition/97500">guidance and code</a> to support static keyword arguments. This contribution substantially improved the usability of <code>HorizonsAPI.jl</code>.</p></section><section class="level1" id="disclaimers"><h1>Disclaimers</h1><p>The software developed in this paper, and the paper itself, was written by the author in a personal capacity. This work does not reflect the views of any organization, employer, or entity, except for the author as an individual.</p></section><section class="level1 unnumbered" id="references"></section><div class="default" id="quarto-appendix"><section class="quarto-appendix-contents" id="quarto-bibliography" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div class="references csl-bib-body hanging-indent" data-entry-spacing="0" id="refs" role="list"><div class="csl-entry" id="ref-cspice" role="listitem">
Acton, C. H. 1996. <span>“<span class="nocase">Ancillary Data Services of NASA’s Navigation and Ancillary Information Facility</span>.”</span><em>Planetary and Space Science</em> 44 (1): 65–70. <a href="https://doi.org/10.1016/0032-0633(95)00107-7">https://doi.org/10.1016/0032-0633(95)00107-7</a>.
</div><div class="csl-entry" id="ref-horizons" role="listitem">
Giorgini, Jon D. 2015. <span>“Status of the JPL Horizons Ephemeris System.”</span><em>IAU General Assembly</em> 29: 2256293.
</div></div></section><section class="footnotes footnotes-end-of-document" id="footnotes" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2><ol><li id="fn1"><p>The code required to support static keyword arguments was provided by Joseph Wilson, as described in the <strong>Acknowledgements</strong> section.<a class="footnote-back" href="#fnref1" role="doc-backlink">↩︎</a></p></li></ol></section></div></main><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script></div></body></HTML>