% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
\PassOptionsToPackage{dvipsnames,svgnames,x11names}{xcolor}
%
\documentclass[
]{article}

\usepackage{amsmath,amssymb}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{lmodern}
\ifPDFTeX\else  
    % xetex/luatex font selection
  \setmainfont[]{Latin Modern Roman}
  \setmathfont[]{Latin Modern Math}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\setlength{\emergencystretch}{3em} % prevent overfull lines
\setcounter{secnumdepth}{5}
% Make \paragraph and \subparagraph free-standing
\ifx\paragraph\undefined\else
  \let\oldparagraph\paragraph
  \renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
  \let\oldsubparagraph\subparagraph
  \renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi


\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
% definitions for citeproc citations
\NewDocumentCommand\citeproctext{}{}
\NewDocumentCommand\citeproc{mm}{%
  \begingroup\def\citeproctext{#2}\cite{#1}\endgroup}
\makeatletter
 % allow citations to break across lines
 \let\@cite@ofmt\@firstofone
 % avoid brackets around text for \cite:
 \def\@biblabel#1{}
 \def\@cite#1#2{{#1\if@tempswa , #2\fi}}
\makeatother
\newlength{\cslhangindent}
\setlength{\cslhangindent}{1.5em}
\newlength{\csllabelwidth}
\setlength{\csllabelwidth}{3em}
\newenvironment{CSLReferences}[2] % #1 hanging-indent, #2 entry-spacing
 {\begin{list}{}{%
  \setlength{\itemindent}{0pt}
  \setlength{\leftmargin}{0pt}
  \setlength{\parsep}{0pt}
  % turn on hanging indent if param 1 is 1
  \ifodd #1
   \setlength{\leftmargin}{\cslhangindent}
   \setlength{\itemindent}{-1\cslhangindent}
  \fi
  % set entry spacing
  \setlength{\itemsep}{#2\baselineskip}}}
 {\end{list}}
\usepackage{calc}
\newcommand{\CSLBlock}[1]{\hfill\break\parbox[t]{\linewidth}{\strut\ignorespaces#1\strut}}
\newcommand{\CSLLeftMargin}[1]{\parbox[t]{\csllabelwidth}{\strut#1\strut}}
\newcommand{\CSLRightInline}[1]{\parbox[t]{\linewidth - \csllabelwidth}{\strut#1\strut}}
\newcommand{\CSLIndent}[1]{\hspace{\cslhangindent}#1}

\usepackage{arxiv}
\usepackage{orcidlink}
\usepackage{amsmath}
\usepackage[T1]{fontenc}
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\AtBeginDocument{%
\ifdefined\contentsname
  \renewcommand*\contentsname{Table of contents}
\else
  \newcommand\contentsname{Table of contents}
\fi
\ifdefined\listfigurename
  \renewcommand*\listfigurename{List of Figures}
\else
  \newcommand\listfigurename{List of Figures}
\fi
\ifdefined\listtablename
  \renewcommand*\listtablename{List of Tables}
\else
  \newcommand\listtablename{List of Tables}
\fi
\ifdefined\figurename
  \renewcommand*\figurename{Figure}
\else
  \newcommand\figurename{Figure}
\fi
\ifdefined\tablename
  \renewcommand*\tablename{Table}
\else
  \newcommand\tablename{Table}
\fi
}
\@ifpackageloaded{float}{}{\usepackage{float}}
\floatstyle{ruled}
\@ifundefined{c@chapter}{\newfloat{codelisting}{h}{lop}}{\newfloat{codelisting}{h}{lop}[chapter]}
\floatname{codelisting}{Listing}
\newcommand*\listoflistings{\listof{codelisting}{List of Listings}}
\makeatother
\makeatletter
\makeatother
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\@ifpackageloaded{subcaption}{}{\usepackage{subcaption}}
\makeatother
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\usepackage{bookmark}

\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same} % disable monospaced font for URLs
\hypersetup{
  pdftitle={Julia Interfaces to Standard Ephemeris Platforms},
  pdfauthor={Joseph D Carpinelli},
  colorlinks=true,
  linkcolor={blue},
  filecolor={Maroon},
  citecolor={Blue},
  urlcolor={Blue},
  pdfcreator={LaTeX via pandoc}}

\renewcommand{\today}{2024-04-21}
\newcommand{\runninghead}{A Preprint }
\title{Julia Interfaces to Standard Ephemeris Platforms}
\def\asep{\\\\\\ } % default: all authors on same column
\author{\textbf{Joseph D
Carpinelli}~\orcidlink{https://orcid.org/0000-0001-8655-8125}\\\href{mailto:joey@loopy.codes}{joey@loopy.codes}}
\date{2024-04-21}
\begin{document}
\maketitle
\begin{abstract}
Solar system ephemerides are available for free to researchers,
students, and professionals in-industry through open source tools, and
REST APIs, and web interfaces. Users commonly parse this data
programatically with dynamic programming languages, including Python and
Julia. This document presents several Julia packages which can aid
ephemeris users in sourcing and parsing data with replicatability.
Rather than include solar system ephemeris files in source code
distrbutions, ephemeris data sourcing can be accomplished directly
in-code. Three packages which interface to the JPL SPICE ephemeris
platform are presented: \texttt{SPICEApplications.jl},
\texttt{SPICEKernels.jl}, and \texttt{SPICEBodies.jl}. In addition, two
packages which interface with the JPL HORIZONS ephemeris platform are
presented: \texttt{HorizonsAPI.jl} and \texttt{HorizonsEphemeris.jl}.
All packages are described in-detail in their common documentation site:
\href{https://ephemeris.loopy.codes}{\texttt{ephemeris.loopy.codes}}.
\end{abstract}

\section{Introduction}\label{sec-intro}

Students and professionals in astronomy, astrodynamics, astrophysics,
and other related fields often download and parse solar system ephemeris
data from two major providers:
\href{https://naif.jpl.nasa.gov/pub/naif/generic_kernels/}{Generic JPL
SPICE Kernels}, and \href{https://ssd.jpl.nasa.gov/horizons/}{JPL
Horizons}. SPICE Kernels are typically read through the SPICE Toolkit,
which is available in a variety of programming languages, include the C
Programming Language with \texttt{CSPICE} (Acton 1996). The Julia
packages
\href{https://github.com/JuliaBinaryWrappers/CSPICE_jll.jl}{\texttt{CSPICE\_jll.jl}}
and \href{https://github.com/JuliaAstro/SPICE.jl}{\texttt{SPICE.jl}}
expose many \texttt{CSPICE} functions through Julia functions. Julia
users can load and interact with SPICE kernels \texttt{SPICE.furnsh} and
\texttt{SPICE.spkez}. Horizons data is available through a variety of
methods, including email, command-line, graphical web interfaces, and a
\href{https://ssd-api.jpl.nasa.gov/doc/horizons.html}{REST API}.

This paper introduces several packages which allow users to download and
process ephemeris data idomatically, all from within Julia. Through the
use of these packages, users can share replicatable code which
automatically fetches publicly available ephemeris data, as opposed to
manually including ephemeris data files with their source code
distribution.

\section{Statement of Need}\label{sec-need}

While ephemeris users have all of the tools they need to fetch and parse
ephemeris data within Julia, they do not have the tools to do so
\emph{simply} or \emph{idiomatically}. Section~\ref{sec-need-horizons}
and Section~\ref{sec-need-spice} present the research needs filled by
each of the five packages introduced in this paper.

\subsection{JPL HORIZONS}\label{sec-need-horizons}

The two HORIZONS-related packages presented in this paper ---
\href{https://github.com/cadojo/HorizonsAPI.jl}{\texttt{HorizonsAPI.jl}}
and
\href{https://github.com/cadojo/HorizonsEphemeris.jl}{\texttt{HorizonsEphemeris.jl}}
--- are respectively the first Julia packages to precisely match the
REST API with tab-completion through static keyword arguments, and the
first to offer automatic response parsing into \texttt{NamedTuple}
types. The \texttt{NamedTuple} output of
\texttt{HorizonsEphemeris.ephemeris}, the top-level method for fetching
Cartesian state vectors from the HORIZONS platform, allows for easy
plotting, file-saving, and \texttt{DataFrame} construction. Both
\texttt{HorizonsAPI.jl} and \texttt{HorizonsEphemeris.jl} offer users a
simple, repeatable way to query and parse HORIZONS ephemeris data.

\subsection{JPL SPICE}\label{sec-need-spice}

The three SPICE-related packages presented in this paper ---
\href{https://github.com/cadojo/SPICEApplications.jl}{\texttt{SPICEApplications.jl}},
\href{https://github.com/cadojo/SPICEKernels.jl}{\texttt{SPICEKernels.jl}},
and
\href{https://github.com/cadojo/SPICEBodies.jl}{\texttt{SPICEBodies.jl}}
--- provide idiomatic kernel fetching, inspection, and caching from
within Julia. While SPICE Toolkit executables were \emph{bundled} in
Julia through
\href{https://github.com/JuliaBinaryWrappers/CSPICE_jll.jl}{\texttt{CSPICE\_jll}},
they have not been previously \emph{exposed} through Julia functions.
\texttt{SPICEApplications.jl} wraps each executable with a Julia
function, allowing users to easily call SPICE Toolkit executables within
their Julia programs, just as they can with \texttt{CSPICE} routines
wrapped in
\href{https://github.com/JuliaAstro/SPICE.jl}{\texttt{SPICE.jl}}.

Julia users interact with SPICE kernels by downloading
publicly-available
a\href{https://naif.jpl.nasa.gov/pub/naif/generic_kernels/}{Generic
Kernels}, and parsing the data using \texttt{SPICE.jl}, or another
ephemeris parsing source. This workflow requires that users know how to
find the correct generic kernels for their chosen application, and that
they know how to use CSPICE functions to retrieve their desired data.
\texttt{SPICEKernels.jl} and \texttt{SPICEBodies.jl} offer idiomatic
interfaces to ephemeris fetching and parsing parsing respectively.
Continuous integration in the
\href{https://github.com/cadojo/SPICEKernels.jl}{\texttt{SPICEKernels.jl}
repository} multiple times daily, and automatically exports all
available generic kernels as variables in Julia. SPICE Toolkit
executables (provided by \texttt{SPICEApplications.jl}) are used to
retrieve a description of each kernel's contents, and place that
description in the Julia variable's docstring. As a result, users can
use tab-completion and Julia's built-in documentation tools to inspect
kernel contents, and download the correct kernel for their application.
Once each kernel is downloaded and loaded into the SPICE kernel pool
with \texttt{SPICE.jl}, users can use \texttt{SPICEBodies.jl} to
idiomatically fetch data at a provided instance in time.

\section{Usage}\label{sec-usage}

For detailed usage examples, consult the common
\href{https://ephemeris.loopy.codes}{documentation site} for all of the
packages presented in this paper. The code examples below show how a
user may retrieve data from the HORIZONS platform, inspect a SPICE
kernel before downloading it, and retrieve Cartesian state data at an
instance in time.

\textsubscript{Source:
\href{https://cadojo.github.io/ephemeris.loopy.codes/index.qmd.html}{Article
Notebook}}

\begin{codelisting}

\caption{\label{lst-horizons-fetching}Querying JPL HORIZONS in Julia}

\centering{

\begin{verbatim}
using Dates, DataFrames
using HorizonsEphemeris

ephemeris("earth", now()) |> DataFrame
\end{verbatim}

}

\end{codelisting}%

\begin{tabular}{r|ccccccc}
    & t & cal & x & y & z & ẋ & \\
    \hline
    & Float64 & String31 & Float64 & Float64 & Float64 & Float64 & \\
    \hline
    1 & 2.46042e6 &  A.D. 2024-Apr-21 16:06:17.0241 & -0.862456 & -0.488047 & -0.211335 & 0.00876658 & $\dots$ \\
\end{tabular}

\textsubscript{Source:
\href{https://cadojo.github.io/ephemeris.loopy.codes/index.qmd.html}{Article
Notebook}}

\begin{codelisting}

\caption{\label{lst-spice-inspection}Inspecting Generic SPICE Kernels in
Julia}

\centering{

\begin{verbatim}
using SPICEApplications, SPICEKernels

brief(de440s()); # alternatively, check the kernel variable's docstring: @doc(de440s)
\end{verbatim}

}

\end{codelisting}%

\begin{verbatim}
 
BRIEF -- Version 4.1.0, September 17, 2021 -- Toolkit Version N0067
 
 
Summary for: /Users/joey/.julia/scratchspaces/8e9d28ce-e483-4ef7-bfd9-45b8fef6369c/kernels/de440s.bsp
 
Bodies: MERCURY BARYCENTER (1)  SATURN BARYCENTER (6)   MERCURY (199)
        VENUS BARYCENTER (2)    URANUS BARYCENTER (7)   VENUS (299)
        EARTH BARYCENTER (3)    NEPTUNE BARYCENTER (8)  MOON (301)
        MARS BARYCENTER (4)     PLUTO BARYCENTER (9)    EARTH (399)
        JUPITER BARYCENTER (5)  SUN (10)
        Start of Interval (ET)              End of Interval (ET)
        -----------------------------       -----------------------------
        1849 DEC 26 00:00:00.000            2150 JAN 22 00:00:00.000
 
\end{verbatim}

\textsubscript{Source:
\href{https://cadojo.github.io/ephemeris.loopy.codes/index.qmd.html}{Article
Notebook}}

\begin{codelisting}

\caption{\label{lst-spice-fetching}Using SPICE Kernels in Julia}

\centering{

\begin{verbatim}
using Dates, SPICE
using SPICEKernels, SPICEBodies

return furnsh(
    de432s(),                   # position and velocity data for nearby planets
    latest_leapseconds_lsk(),   # timekeeping, parsing epochs
    gm_de440(),                 # mass parameters for major solar system bodies
    pck00011(),                 # physical properties of major solar system bodies
)

earth = KernelBody("earth")
x, y, z, ẋ, ẏ, ż = earth(now())
\end{verbatim}

}

\end{codelisting}%

\begin{verbatim}
6-element Vector{Float64}:
  -1.2902152989585207e8
  -7.301079489346015e7
  -3.161527373450055e7
  15.178959061081855
 -23.355316033584334
 -10.12327706840625
\end{verbatim}

\textsubscript{Source:
\href{https://cadojo.github.io/ephemeris.loopy.codes/index.qmd.html}{Article
Notebook}}

\section{External Packages}\label{external-packages}

The packages presented in this paper which interact with the SPICE
Toolkit require users to use
\href{https://github.com/JuliaAstro/SPICe.jl}{\texttt{SPICE.jl}}, or
another SPICE-compatible kernel loading tool. Support for other SPICE
kernel management packages, such as
\href{https://github.com/JuliaSpaceMissionDesign/Ephemerides.jl}{\texttt{Ephemerides.jl}},
may be added in the future.

In addition to the packages in this paper which interface with the JPL
HORIZONS ephemeris platform, the
\href{https://github.com/PerezHz/HORIZONS.jl}{\texttt{HORIZONS.JL}}
package offers simplified interfaces for constructing and sending
queries to the JPL HORIZONS REST API.

\section{References}\label{sec-ref}

\textsubscript{Source:
\href{https://cadojo.github.io/ephemeris.loopy.codes/index.qmd.html}{Article
Notebook}}

\phantomsection\label{refs}
\begin{CSLReferences}{1}{0}
\bibitem[\citeproctext]{ref-cspice}
Acton, C. H. 1996. {``{Ancillary Data Services of NASA's Navigation and
Ancillary Information Facility}.''} \emph{Planetary and Space Science}
44 (1): 65--70.

\end{CSLReferences}



\end{document}
